// -----------------------------------------------------------------------------
//  G4OpSim | OpticalMaterialProperties.cpp
//
//  * Author:
//  * Creation date: 26 March 2020
// -----------------------------------------------------------------------------

#include "OpticalMaterialProperties.h"

#include <G4MaterialPropertiesTable.hh>

#include <CLHEP/Units/PhysicalConstants.h>

using CLHEP::h_Planck;
using CLHEP::c_light;


G4MaterialPropertiesTable* OpticalMaterialProperties::Vacuum()
{
  G4MaterialPropertiesTable* mpt = new G4MaterialPropertiesTable();

  G4double energies[] = {OpticalMaterialProperties::energy_min,
                         OpticalMaterialProperties::energy_max};

  // Refractive index (RINDEX)
  G4double rindex[] = {1., 1.};
  mpt->AddProperty("RINDEX", energies, rindex, 2);

  // Absorption length (ABSLENGTH)
  G4double abslength[] = {OpticalMaterialProperties::abslength_max,
                          OpticalMaterialProperties::abslength_max};
  mpt->AddProperty("ABSLENGTH", energies, abslength, 2);

  return mpt;
}

G4MaterialPropertiesTable* OpticalMaterialProperties::LAr()
{
  G4MaterialPropertiesTable* mpt = new G4MaterialPropertiesTable();

  G4double energy_step = 0.05 * eV;
  G4double energy_curr = OpticalMaterialProperties::energy_min;
  std::vector<G4double> energies;

  do {
    energies.push_back(energy_curr);
    energy_curr += energy_step;
  } while(energy_curr < OpticalMaterialProperties::energy_max);

  // Refractive index (RINDEX)
  // Add here reference to LAr paper
  G4double a0  = 0.335;
  G4double aUV = 0.099;
  G4double aIR = 0.008;
  G4double lambdaUV = 106.6 * nm;
  G4double lambdaIR = 908.3 * nm;
  std::vector<G4double> rindex;

  for (auto energy: energies) {

    G4double wavelength = h_Planck * c_light / energy;
    G4double x = a0 + aUV * pow (wavelength, 2) / (pow (wavelength, 2) - pow (lambdaUV, 2)) + aIR * pow (wavelength, 2) / (pow (wavelength, 2) - pow (lambdaIR, 2));
    G4double rindex_element = sqrt (1 + 3 * x / (3 - x));
    rindex.push_back(rindex_element);
  }

  mpt->AddProperty("RINDEX", energies.data(), rindex.data(), energies.size());

  // Absorption length (ABSLENGTH)
  G4double energies_lim[]  = {OpticalMaterialProperties::energy_min,
                              OpticalMaterialProperties::energy_max};
  G4double abslength[]     = {OpticalMaterialProperties::abslength_max,
                              OpticalMaterialProperties::abslength_max};
  mpt->AddProperty("ABSLENGTH", energies_lim, abslength, 2);

  return mpt;
}

G4MaterialPropertiesTable* OpticalMaterialProperties::PVT()
{
  G4MaterialPropertiesTable* mpt = new G4MaterialPropertiesTable();

  G4double energy_step = 0.05 * eV;
  G4double energy_curr = OpticalMaterialProperties::energy_min;
  std::vector<G4double> energies;

  do {
    energies.push_back(energy_curr);
    energy_curr += energy_step;
  } while(energy_curr < 7.5 * eV); // Put 7.5 eV instead of energy_max = 11.3 eV in order to avoid divergence.

  // Refractive index (RINDEX)
  // Add here reference to Sellmeier fit
  G4double A = 1.421;
  G4double B1 = 0.9944;
  G4double C1 = 26250 * pow (nm, 2);
  std::vector<G4double> rindex;

  for (auto energy: energies) {

    G4double wavelength = h_Planck * c_light / energy;
    G4double rindex_element = sqrt (A + B1 * pow (wavelength, 2) / (pow (wavelength, 2) - C1));;
    rindex.push_back(rindex_element);
  }

  mpt->AddProperty("RINDEX", energies.data(), rindex.data(), energies.size());

  // Absorption length (ABSLENGTH)
  G4double energies_lim[]  = {OpticalMaterialProperties::energy_min,
                              OpticalMaterialProperties::energy_max};
  G4double abslength[]     = {2.*m, 2.*m};
  mpt->AddProperty("ABSLENGTH", energies_lim, abslength, 2);

  G4double WLS_emi_energy[186] = {4.42590000216545,4.38671486642297,4.35525987783266,4.32426785838653,4.29371380068625,4.26358848632379,4.23386849376717,4.20457422900815,4.17568255453074,4.14717135389580,4.11906054328327,4.09132825447701,4.06395357052505,4.03695592077182,4.01031460530515,3.98402261564442,3.95806048845963,3.93244701247465,3.90716290588982,3.88218969853889,3.85754570721126,3.83321262049682,3.80917288721418,3.78544436096583,3.76200962936397,3.73886326955439,3.71598885240489,3.69340362915143,3.67109128657338,3.64903616769553,3.62725508419952,3.60573248025495,3.58445341757058,3.56343427925313,3.54266021514925,3.52212696391006,3.50182047045980,3.48175656402095,3.46192126266876,3.44230112294909,3.42291157196373,3.40373922969101,3.38477122486425,3.36602259389756,3.34748052036436,3.32914160943828,3.31099369705092,3.29305131639053,3.27530234828974,3.25773512111079,3.24036380369325,3.22317676283250,3.20616278964998,3.18933569965637,3.17268431667285,3.15484042496375,3.14623306830280,3.13802996371715,3.12911110044206,3.12279730740357,3.11783359223186,3.11241670480351,3.10645024634277,3.10182545897010,3.09661096566483,3.09326528291276,3.09136001193613,3.08659555937299,3.08354756660365,3.08078118712622,3.07846309612938,3.07571345907360,3.07111880468849,3.07290779115198,3.06680337612291,3.06411238650281,3.06110861437504,3.05746962342871,3.05442617326260,3.05311724631259,3.05024005114570,3.04737576476532,3.04469631225847,3.04080529315106,3.04052188431322,3.04038019970405,3.03456019344688,3.03153250491906,3.02970250018093,3.02524418488768,3.01966580300861,3.01473833208464,3.00946888529567,3.00515729393242,2.99973252038429,2.99418265259641,2.98927305569121,2.98507659974122,2.98019679569808,2.97302100636139,2.96617064559140,2.95877259907713,2.94954344018704,2.94051117003143,2.92570167211809,2.91226472223170,2.90530301904773,2.89779186278260,2.89565971004576,2.88844726167284,2.88403904975242,2.87948374196384,2.87574977406997,2.87295731165346,2.86759424179867,2.86309069412850,2.85860126989220,2.85411933165233,2.84965797622328,2.84528891009617,2.84120668846998,2.83643508019973,2.83250116781642,2.82536770505061,2.82132314302547,2.81718130421446,2.81239427732210,2.80597754422627,2.79611071262492,2.78900854046038,2.78065066721068,2.77184063318978,2.76168895412722,2.75161747096506,2.74299016490287,2.73476062560177,2.72657432231462,2.71844284412526,2.71035972282864,2.70382749626279,2.69466480839247,2.68639040338257,2.67849649349760,2.67064883991377,2.66284703724360,2.65509068482286,2.64737938664201,2.63939239847159,2.62975647346963,2.61952071469798,2.61629763839235,2.60667582280547,2.59924279380574,2.58974578502884,2.58312991597720,2.57310367388198,2.56420471298458,2.55500369152655,2.54570116888112,2.53570865417814,2.52716906968784,2.51794501935985,2.50890991667112,2.49858905511557,2.48835775399805,2.47820990207791,2.46814448255125,2.45815562076210,2.44825212028544,2.43842809871660,2.42867784501046,2.41900997540648,2.40941877065123,2.39989867642857,2.39045812721086,2.38109156007801,2.37238363370389,2.36339217530810,2.35617359154163,2.34887434769595,2.34034703132841,2.33085106270994,2.32245387325893,2.31411697051807,2.30483652923832,2.29634887996838};
  G4double WLS_emiSpectrum[186] = {8.43609365375768e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,2.10902341343942e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,2.10902341343942e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,4.21804682687884e-05,6.32707024031826e-05,8.43609365375768e-05,0.000295263277881519,0.000506165619225461,0.000843609365375768,0.00126541404806365,0.00164503826248275,0.00208793317930503,0.00250973786199291,0.00299481324708398,0.00354315933457823,0.00398605425140051,0.00438676869995399,0.00480857338264188,0.00527255853359855,0.00577872415282401,0.00609507766483992,0.00651688234752781,0.00738158194703797,0.00693868703021569,0.00786665733212904,0.00835173271722011,0.00881571786817678,0.00927970301913345,0.00970150770182133,0.0101444026186436,0.0106083877696003,0.0109669217498850,0.0113254557301697,0.0117261701787232,0.0124221479051582,0.0119792529883359,0.0129494037585180,0.0133290279729371,0.0137297424214906,0.0143835396796568,0.0150162467036887,0.0156278634935861,0.0161972998152147,0.0168089166051122,0.0173150822243376,0.0178001576094287,0.0182430525262510,0.0186859474430733,0.0190866618916268,0.0194873763401802,0.0199302712570025,0.0203309857055560,0.0205840685151687,0.0209215122613191,0.0210058731978566,0.0209004220271847,0.0204997075786312,0.0201411735983465,0.0197826396180618,0.0194241056377771,0.0190444814233580,0.0186648572089389,0.0182852329945198,0.0179056087801007,0.0174838040974128,0.0170619994147249,0.0166401947320370,0.0162183900493491,0.0157544048983925,0.0153536904498390,0.0149318857671511,0.0145311713185976,0.0141515471041785,0.0137719228897594,0.0133922986753403,0.0130759451633244,0.0126963209489053,0.0123588772027550,0.0119581627542015,0.0115363580715136,0.0111989143253633,0.0108403803450786,0.0105240268330627,0.0101444026186436,0.00974368817009012,0.00934297372153663,0.00892116903884875,0.00847827412202647,0.00807755967347298,0.00763466475665070,0.00723395030809721,0.00676996515714054,0.00634816047445266,0.00592635579176477,0.00552564134321128,0.00512492689465779,0.00474530268023870,0.00434458823168521,0.00400714448553490,0.00377515191005656,0.00352206910044383,0.00337443746150307,0.00312135465189034,0.00301590348121837,0.00274173043747125,0.00263627926679928,0.00244646715958973,0.00231992575478336,0.00215120388170821,0.00198248200863306,0.00181376013555790,0.00170830896488593,0.00153958709181078,0.00141304568700441,0.00128650428219805,0.00115996287739168,0.00105451170671971,0.000949060536047739,0.000843609365375768,0.000780338662972586,0.000695977726435009,0.000611616789897432,0.000569436321628644,0.000485075385091067,0.000442894916822278,0.000379624214419096,0.000337443746150307,0.000316353512015913,0.000295263277881519,0.000253082809612730,0.000231992575478336,0.000231992575478336,0.000210902341343942,0.000189812107209548,0.000189812107209548,0.000189812107209548};
  int WLS_emi_entries = 186;
  mpt->AddProperty("WLSCOMPONENT", WLS_emi_energy, WLS_emiSpectrum, WLS_emi_entries);

  return mpt;
}
